(function ($) {

    $(document).ready(function () { 
        
		
        let preloader = `<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" style="shape-rendering: auto; display: block; background: transparent;" width="20" height="20" xmlns:xlink="http://www.w3.org/1999/xlink"><g><circle stroke-dasharray="164.93361431346415 56.97787143782138" r="35" stroke-width="9" stroke="#ffffff" fill="none" cy="50" cx="50">
                        <animateTransform keyTimes="0;1" values="0 50 50;360 50 50" dur="1s" repeatCount="indefinite" type="rotate" attributeName="transform"></animateTransform>
                    </circle><g></g></g><!-- [ldio] generated by https://loading.io --></svg>`;

        // Select #cart_type on change
        $('#cart_type').on('change', function () {
            let cartType = $(this).val(); 
            if('cart_total' == cartType) {
                $('.condition-wrap').addClass('active'); 
                $('.total-amount-wrap').addClass('active'); 
                $('.total-item-wrap').removeClass('active'); 
                $('.products-wrap').removeClass('active'); 

            }
            if('cart_total_items' == cartType) {
                $('.condition-wrap').addClass('active'); 
                $('.total-item-wrap').addClass('active');
                $('.total-amount-wrap').removeClass('active');  
                $('.products-wrap').removeClass('active'); 

            }
            if('specific_products' == cartType) { 
                $('.products-wrap').addClass('active'); 
                $('.condition-wrap').removeClass('active'); 
                $('.total-item-wrap').removeClass('active');
                $('.total-amount-wrap').removeClass('active');  

            }
        });

        // Loade select 2
        $("#specific_products").select2({
            placeholder: "Select options",
            allowClear: true
        });
        

        $(document).on('submit', '#wtd-popup-settings-form', function (e) {  
            e.preventDefault();   
            $this = $(this);
            var data  = new FormData(this);  
            // remove html 
            $this.find('.wtd-promocart-settings-submit svg').remove();
            $this.find('.wtd-promocart-settings-submit').append(preloader);
             
            
            data.append('action', 'wtd_promocart_popup_save_settings');   
            $.ajax({
                url: wtd_promocart_popup_admin.ajaxurl, 
                type: 'POST',
                data: data,
                processData: false,
                contentType: false,
                success: function (response) {
                    if(response.success){  

                        $this.find('.wtd-promocart-settings-submit').html('');
                        $this.find('.wtd-promocart-settings-submit').append(wtd_promocart_popup_admin.setting_saved); 
                        // after 2 seconds remove notice  

                    }else{  
                        let fieldErrors = response.fieldErrors;

                        $this.find('.wtd-promocart-settings-submit svg').remove(); 
                        alert(response.message);
                    }
                },
                error: function (error) {
                    console.log(error);
                }
            });
        });
 
	}) 

})(jQuery);

 